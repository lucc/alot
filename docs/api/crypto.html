
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>4.7. Crypto &#8212; Alot User Manual</title>
    <link rel="stylesheet" href="../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="5. FAQ" href="../faq.html" />
    <link rel="prev" title="4.6. Commands" href="commands.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../faq.html" title="5. FAQ"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="commands.html" title="4.6. Commands"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Alot User Manual</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">4. API and Development</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="module-alot.crypto">
<span id="crypto"></span><h1>4.7. Crypto<a class="headerlink" href="#module-alot.crypto" title="Permalink to this headline">¶</a></h1>
<dl class="function">
<dt id="alot.crypto.RFC3156_micalg_from_algo">
<code class="descclassname">alot.crypto.</code><code class="descname">RFC3156_micalg_from_algo</code><span class="sig-paren">(</span><em>hash_algo</em><span class="sig-paren">)</span><a class="headerlink" href="#alot.crypto.RFC3156_micalg_from_algo" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts a GPGME hash algorithm name to one conforming to RFC3156.</p>
<p>GPGME returns hash algorithm names such as “SHA256”, but RFC3156 says that
programs need to use names such as “pgp-sha256” instead.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>hash_algo</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – GPGME hash_algo</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">the lowercase name of of the algorithm with “pgp-” prepended</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)">str</a></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="alot.crypto.bad_signatures_to_str">
<code class="descclassname">alot.crypto.</code><code class="descname">bad_signatures_to_str</code><span class="sig-paren">(</span><em>error</em><span class="sig-paren">)</span><a class="headerlink" href="#alot.crypto.bad_signatures_to_str" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert a bad signature exception to a text message.
This is a workaround for gpg not handling non-ascii data correctly.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>error</strong> (<em>BadSignatures</em>) – BadSignatures exception</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="alot.crypto.check_uid_validity">
<code class="descclassname">alot.crypto.</code><code class="descname">check_uid_validity</code><span class="sig-paren">(</span><em>key</em>, <em>email</em><span class="sig-paren">)</span><a class="headerlink" href="#alot.crypto.check_uid_validity" title="Permalink to this definition">¶</a></dt>
<dd><p>Check that a the email belongs to the given key.  Also check the trust
level of this connection.  Only if the trust level is high enough (&gt;=4) the
email is assumed to belong to the key.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>key</strong> (<em>gpg.gpgme._gpgme_key</em>) – the GPG key to which the email should belong</li>
<li><strong>email</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – the email address that should belong to the key</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">whether the key can be assumed to belong to the given email</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)">bool</a></p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="alot.crypto.decrypt_verify">
<code class="descclassname">alot.crypto.</code><code class="descname">decrypt_verify</code><span class="sig-paren">(</span><em>encrypted</em>, <em>session_keys=None</em><span class="sig-paren">)</span><a class="headerlink" href="#alot.crypto.decrypt_verify" title="Permalink to this definition">¶</a></dt>
<dd><p>Decrypts the given ciphertext string and returns both the
signatures (if any) and the plaintext.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>encrypted</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.7)"><em>bytes</em></a>) – the mail to decrypt</li>
<li><strong>session_keys</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.7)"><em>list</em></a><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a><em>]</em>) – a list OpenPGP session keys</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">the signatures and decrypted plaintext data</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.7)">tuple</a>[<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.7)">list</a>[gpg.resuit.Signature], <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)">str</a>]</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body"><p class="first last"><code class="xref py py-class docutils literal notranslate"><span class="pre">GPGProblem</span></code> if the decryption fails</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="alot.crypto.detached_signature_for">
<code class="descclassname">alot.crypto.</code><code class="descname">detached_signature_for</code><span class="sig-paren">(</span><em>plaintext_str</em>, <em>keys</em><span class="sig-paren">)</span><a class="headerlink" href="#alot.crypto.detached_signature_for" title="Permalink to this definition">¶</a></dt>
<dd><p>Signs the given plaintext string and returns the detached signature.</p>
<p>A detached signature in GPG speak is a separate blob of data containing
a signature for the specified plaintext.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>plaintext_str</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.7)"><em>bytes</em></a>) – bytestring to sign</li>
<li><strong>keys</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.7)"><em>list</em></a><em>[</em><em>gpg.gpgme._gpgme_key</em><em>]</em>) – list of one or more key to sign with.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">A list of signature and the signed blob of data</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.7)">tuple</a>[<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.7)">list</a>[gpg.results.NewSignature], <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)">str</a>]</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="alot.crypto.encrypt">
<code class="descclassname">alot.crypto.</code><code class="descname">encrypt</code><span class="sig-paren">(</span><em>plaintext_str</em>, <em>keys</em><span class="sig-paren">)</span><a class="headerlink" href="#alot.crypto.encrypt" title="Permalink to this definition">¶</a></dt>
<dd><p>Encrypt data and return the encrypted form.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>plaintext_str</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.7)"><em>bytes</em></a>) – the mail to encrypt</li>
<li><strong>key</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.7)"><em>list</em></a><em>[</em><em>gpg.gpgme.gpgme_key_t</em><em>] or </em><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.7)"><em>None</em></a>) – optionally, a list of keys to encrypt with</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">encrypted mail</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)">str</a></p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="alot.crypto.get_key">
<code class="descclassname">alot.crypto.</code><code class="descname">get_key</code><span class="sig-paren">(</span><em>keyid</em>, <em>validate=False</em>, <em>encrypt=False</em>, <em>sign=False</em>, <em>signed_only=False</em><span class="sig-paren">)</span><a class="headerlink" href="#alot.crypto.get_key" title="Permalink to this definition">¶</a></dt>
<dd><p>Gets a key from the keyring by filtering for the specified keyid, but
only if the given keyid is specific enough (if it matches multiple
keys, an exception will be thrown).</p>
<p>If validate is True also make sure that returned key is not invalid,
revoked or expired. In addition if encrypt or sign is True also validate
that key is valid for that action. For example only keys with private key
can sign. If signed_only is True make sure that the user id can be trusted
to belong to the key (is signed). This last check will only work if the
keyid is part of the user id associated with the key, not if it is part of
the key fingerprint.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>keyid</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – filter term for the keyring (usually a key ID)</li>
<li><strong>validate</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – validate that returned keyid is valid</li>
<li><strong>encrypt</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – when validating confirm that returned key can encrypt</li>
<li><strong>sign</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – when validating confirm that returned key can sign</li>
<li><strong>signed_only</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – only return keys  whose uid is signed (trusted to
belong to the key)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">A gpg key matching the given parameters</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first">gpg.gpgme._gpgme_key</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body"><ul class="first last simple">
<li><strong>GPGProblem</strong> – if the keyid is ambiguous</li>
<li><strong>GPGProblem</strong> – if there is no key that matches the
parameters</li>
<li><strong>GPGProblem</strong> – if a key is found, but signed_only is true
and the key is unused</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="alot.crypto.list_keys">
<code class="descclassname">alot.crypto.</code><code class="descname">list_keys</code><span class="sig-paren">(</span><em>hint=None</em>, <em>private=False</em><span class="sig-paren">)</span><a class="headerlink" href="#alot.crypto.list_keys" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a generator of all keys containing the fingerprint, or all keys if
hint is None.</p>
<p>The generator may raise exceptions of :class:gpg.errors.GPGMEError, and it
is the caller’s responsibility to handle them.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>hint</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a><em> or </em><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.7)"><em>None</em></a>) – Part of a fingerprint to usee to search</li>
<li><strong>private</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – Whether to return public keys or secret keys</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">A generator that yields keys.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">Generator[gpg.gpgme.gpgme_key_t, <a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.7)">None</a>, <a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.7)">None</a>]</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="alot.crypto.validate_key">
<code class="descclassname">alot.crypto.</code><code class="descname">validate_key</code><span class="sig-paren">(</span><em>key</em>, <em>sign=False</em>, <em>encrypt=False</em><span class="sig-paren">)</span><a class="headerlink" href="#alot.crypto.validate_key" title="Permalink to this definition">¶</a></dt>
<dd><p>Assert that a key is valide and optionally that it can be used for
signing or encrypting.  Raise GPGProblem otherwise.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>key</strong> (<em>gpg.gpgme._gpgme_key</em>) – the GPG key to check</li>
<li><strong>sign</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – whether the key should be able to sign</li>
<li><strong>encrypt</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – whether the key should be able to encrypt</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body"><ul class="first last simple">
<li><strong>GPGProblem</strong> – If the key is revoked, expired, or invalid</li>
<li><strong>GPGProblem</strong> – If encrypt is true and the key cannot be
used to encrypt</li>
<li><strong>GPGProblem</strong> – If sign is true and th key cannot be used
to encrypt</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="alot.crypto.verify_detached">
<code class="descclassname">alot.crypto.</code><code class="descname">verify_detached</code><span class="sig-paren">(</span><em>message</em>, <em>signature</em><span class="sig-paren">)</span><a class="headerlink" href="#alot.crypto.verify_detached" title="Permalink to this definition">¶</a></dt>
<dd><p>Verifies whether the message is authentic by checking the signature.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>message</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.7)"><em>bytes</em></a>) – The message to be verified, in canonical form.</li>
<li><strong>signature</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.7)"><em>bytes</em></a>) – the OpenPGP signature to verify</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">a list of signatures</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.7)">list</a>[gpg.results.Signature]</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body"><p class="first last"><code class="xref py py-class docutils literal notranslate"><span class="pre">GPGProblem</span></code> if the verification fails</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="commands.html"
                        title="previous chapter">4.6. Commands</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../faq.html"
                        title="next chapter">5. FAQ</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/api/crypto.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../faq.html" title="5. FAQ"
             >next</a> |</li>
        <li class="right" >
          <a href="commands.html" title="4.6. Commands"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Alot User Manual</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >4. API and Development</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2014, Patrick Totzke.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.0.
    </div>
  </body>
</html>